<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>Clackgram ‚ú¶ –ø—Ä–µ–º–∏—É–º</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-auth-compat.js"></script>
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        }

        body {
            background: #000000;
            color: #fff;
            min-height: 100vh;
            display: flex;
            justify-content: center;
            position: relative;
            overflow-x: hidden;
        }

        /* –ö—Ä–∞—Å–∏–≤—ã–µ –∑–≤–µ–∑–¥—ã */
        .stars {
            position: fixed;
            width: 100%;
            height: 100%;
            background: #000000;
            background-image: 
                radial-gradient(2px at 5% 10%, #fff 1px, transparent 0),
                radial-gradient(2px at 15% 25%, #9d4eff 1px, transparent 0),
                radial-gradient(2px at 25% 40%, #fff 1px, transparent 0),
                radial-gradient(2px at 35% 15%, #9d4eff 1px, transparent 0),
                radial-gradient(2px at 45% 70%, #ff6b9d 1px, transparent 0),
                radial-gradient(2px at 55% 85%, #9d4eff 1px, transparent 0);
            background-size: 300% 300%;
            pointer-events: none;
            z-index: 0;
            animation: twinkling 10s infinite alternate;
        }

        @keyframes twinkling {
            0% { opacity: 0.4; background-position: 0% 0%; }
            50% { opacity: 0.8; background-position: 50% 50%; }
            100% { opacity: 0.4; background-position: 100% 100%; }
        }

        /* –î–µ–∫–æ—Ä–∞—Ç–∏–≤–Ω—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã –¥–ª—è —Ñ–æ–Ω–∞ */
        .bg-decor {
            position: fixed;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 0;
            opacity: 0.1;
        }

        .bg-decor::before {
            content: '';
            position: absolute;
            top: 10%;
            right: 5%;
            width: 300px;
            height: 300px;
            background: radial-gradient(circle, #9d4eff 0%, transparent 70%);
            border-radius: 50%;
            filter: blur(60px);
            animation: float 15s infinite alternate;
        }

        .bg-decor::after {
            content: '';
            position: absolute;
            bottom: 10%;
            left: 5%;
            width: 400px;
            height: 400px;
            background: radial-gradient(circle, #ff6b9d 0%, transparent 70%);
            border-radius: 50%;
            filter: blur(80px);
            animation: float 20s infinite alternate-reverse;
        }

        @keyframes float {
            from { transform: translate(0, 0) scale(1); }
            to { transform: translate(30px, -30px) scale(1.2); }
        }

        .page {
            display: none;
            width: 100%;
            max-width: 400px;
            padding: 16px;
            position: relative;
            z-index: 2;
            flex-direction: column;
            justify-content: center;
            min-height: 100vh;
        }

        #page1 {
            display: flex;
        }

        .card {
            background: rgba(26, 26, 26, 0.9);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border-radius: 32px;
            padding: 32px 20px;
            border: 1px solid #2a2a2a;
            width: 100%;
        }

        h1 {
            font-size: 36px;
            font-weight: 700;
            margin-bottom: 32px;
            text-align: center;
            color: #fff;
        }

        .label {
            font-size: 13px;
            color: #aaa;
            margin-bottom: 6px;
            margin-left: 4px;
        }

        input, textarea {
            width: 100%;
            padding: 16px;
            margin-bottom: 16px;
            background: #2a2a2a;
            border: 1px solid #3a3a3a;
            border-radius: 24px;
            color: #fff;
            font-size: 16px;
        }

        input:focus, textarea:focus {
            outline: none;
            border-color: #9d4eff;
        }

        button {
            width: 100%;
            padding: 16px;
            background: #2a2a2a;
            border: none;
            border-radius: 24px;
            color: #666;
            font-size: 17px;
            font-weight: 600;
            cursor: pointer;
        }

        button.active {
            background: #9d4eff;
            color: #fff;
        }

        .bottom-text {
            text-align: center;
            color: #666;
            font-size: 13px;
            margin-top: 20px;
        }

        .avatar-wrap {
            display: flex;
            justify-content: center;
            margin-bottom: 24px;
        }

        .avatar-circle {
            width: 100px;
            height: 100px;
            background: #2a2a2a;
            border: 3px solid #9d4eff;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            overflow: hidden;
        }

        .avatar-circle svg {
            width: 50px;
            height: 50px;
            stroke: #9d4eff;
        }

        .avatar-circle img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        #fileInput {
            display: none;
        }

        .error {
            color: #ff4d4d;
            font-size: 12px;
            margin-bottom: 10px;
            display: none;
        }

        .app {
            display: none;
            width: 100%;
            max-width: 480px;
            height: 100vh;
            position: relative;
            z-index: 2;
        }

        .screen {
            display: none;
            height: 100vh;
            overflow-y: auto;
            padding: 0 0 80px 0;
            scrollbar-width: thin;
            scrollbar-color: #9d4eff #1a1a1a;
        }

        .screen::-webkit-scrollbar {
            width: 4px;
        }

        .screen::-webkit-scrollbar-track {
            background: #1a1a1a;
        }

        .screen::-webkit-scrollbar-thumb {
            background: #9d4eff;
            border-radius: 10px;
        }

        .screen.active {
            display: block;
        }

        .loading {
            text-align: center;
            padding: 50px;
            color: #666;
            display: none;
        }

        .screen-header {
            position: sticky;
            top: 10px;
            background: #1a1a1a;
            margin: 10px 16px;
            padding: 12px 20px;
            border-radius: 40px;
            border: 1px solid #2a2a2a;
            z-index: 10;
            display: flex;
            align-items: center;
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
        }

        .screen-title {
            font-size: 20px;
            font-weight: 600;
            color: #fff;
            flex: 1;
        }

        .back-button, .search-button, .add-button {
            color: #9d4eff;
            font-size: 18px;
            cursor: pointer;
            padding: 8px;
            border-radius: 50%;
        }

        .empty-state {
            text-align: center;
            color: #666;
            padding: 50px 20px;
            background: #1a1a1a;
            border-radius: 24px;
            margin: 16px;
        }

        /* –ü–û–°–¢–´ */
        .post {
            background: #1a1a1a;
            border: 1px solid #2a2a2a;
            border-radius: 24px;
            padding: 16px;
            margin: 16px;
            position: relative;
        }

        .post.pinned {
            border: 2px solid #9d4eff;
        }

        .post-pin-badge {
            position: absolute;
            top: -10px;
            right: 20px;
            background: #9d4eff;
            color: #fff;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 11px;
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .post-header {
            display: flex;
            gap: 12px;
            margin-bottom: 10px;
            cursor: pointer;
        }

        .post-avatar {
            width: 48px;
            height: 48px;
            border-radius: 50%;
            background: #2a2a2a;
            border: 2px solid #9d4eff;
            overflow: hidden;
        }

        .post-avatar img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .post-user-info {
            flex: 1;
        }

        .post-user-name {
            font-weight: 700;
            color: #fff;
            font-size: 16px;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .verified-badge {
            color: #9d4eff;
            font-size: 14px;
        }

        .post-user-username {
            color: #666;
            font-size: 13px;
        }

        .post-time {
            color: #666;
            font-size: 12px;
        }

        .post-menu {
            position: relative;
        }

        .post-menu-btn {
            color: #666;
            cursor: pointer;
            padding: 5px 10px;
            font-size: 18px;
        }

        .post-menu-dropdown {
            position: absolute;
            right: 0;
            top: 30px;
            background: #2a2a2a;
            border: 1px solid #3a3a3a;
            border-radius: 16px;
            padding: 8px 0;
            display: none;
            z-index: 20;
            min-width: 160px;
        }

        .post-menu-dropdown.show {
            display: block;
        }

        .post-menu-item {
            padding: 12px 16px;
            color: #fff;
            cursor: pointer;
            font-size: 14px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .post-menu-item:hover {
            background: #3a3a3a;
        }

        .post-menu-item.delete {
            color: #ff4d6d;
        }

        .post-content {
            color: #fff;
            font-size: 15px;
            margin: 8px 0 12px 60px;
            line-height: 1.5;
        }

        .post-image {
            margin: 12px 0 12px 60px;
            border-radius: 16px;
            overflow: hidden;
            max-height: 300px;
            border: 1px solid #3a3a3a;
        }

        .post-image img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .post-actions {
            display: flex;
            gap: 30px;
            margin-left: 60px;
            padding-top: 12px;
            border-top: 1px solid #2a2a2a;
        }

        .action {
            display: flex;
            align-items: center;
            gap: 6px;
            color: #777;
            font-size: 14px;
            cursor: pointer;
        }

        .action.liked {
            color: #ff4d6d;
        }

        /* –°–¢–ê–¢–£–° –û–ù–õ–ê–ô–ù/–û–§–õ–ê–ô–ù */
        .status-badge {
            display: inline-block;
            width: 10px;
            height: 10px;
            border-radius: 50%;
            margin-left: 5px;
        }

        .status-online {
            background: #2ecc71;
            box-shadow: 0 0 10px #2ecc71;
        }

        .status-offline {
            background: #666;
        }

        /* –ö–û–ú–ú–ï–ù–¢–ê–†–ò–ò */
        .comments-modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: #000000;
            z-index: 300;
            display: none;
            flex-direction: column;
        }

        .comments-modal.active {
            display: flex;
        }

        .comments-header {
            padding: 16px;
            border-bottom: 1px solid #2a2a2a;
            display: flex;
            align-items: center;
            gap: 16px;
            background: #1a1a1a;
        }

        .comments-header i {
            font-size: 20px;
            color: #9d4eff;
            cursor: pointer;
        }

        .comments-list {
            flex: 1;
            overflow-y: auto;
            padding: 16px;
        }

        .comment-item {
            display: flex;
            gap: 12px;
            margin-bottom: 20px;
        }

        .comment-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: #2a2a2a;
            border: 2px solid #9d4eff;
            overflow: hidden;
            cursor: pointer;
        }

        .comment-avatar img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .comment-bubble {
            flex: 1;
            background: #1a1a1a;
            border-radius: 20px;
            padding: 12px;
            border: 1px solid #2a2a2a;
            position: relative;
        }

        .comment-bubble.pinned {
            border: 2px solid #9d4eff;
        }

        .comment-pin-badge {
            position: absolute;
            top: -10px;
            right: 10px;
            background: #9d4eff;
            color: #fff;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 10px;
        }

        .comment-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 4px;
        }

        .comment-user {
            color: #9d4eff;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .comment-time {
            color: #666;
            font-size: 11px;
        }

        .comment-text {
            color: #fff;
            font-size: 14px;
            margin-bottom: 8px;
        }

        .comment-image {
            max-width: 150px;
            border-radius: 12px;
            margin: 8px 0;
        }

        .comment-actions {
            display: flex;
            gap: 15px;
            margin-top: 8px;
        }

        .comment-action {
            display: flex;
            align-items: center;
            gap: 4px;
            color: #777;
            font-size: 12px;
            cursor: pointer;
        }

        .comment-action.liked {
            color: #ff4d6d;
        }

        .comments-input-area {
            padding: 16px;
            border-top: 1px solid #2a2a2a;
            background: #1a1a1a;
        }

        .comments-input-wrapper {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .comment-attach-btn {
            width: 44px;
            height: 44px;
            background: #2a2a2a;
            border: 1px solid #3a3a3a;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #9d4eff;
            cursor: pointer;
        }

        .comment-input-field {
            flex: 1;
            background: #2a2a2a;
            border: 1px solid #3a3a3a;
            border-radius: 30px;
            padding: 0 16px;
            height: 44px;
            color: #fff;
            font-size: 15px;
        }

        .comment-input-field:focus {
            outline: none;
            border-color: #9d4eff;
        }

        .comment-send-btn {
            width: 44px;
            height: 44px;
            background: #9d4eff;
            border: none;
            border-radius: 50%;
            color: #fff;
            cursor: pointer;
        }

        .comment-preview {
            margin-top: 10px;
            position: relative;
            display: inline-block;
        }

        .comment-preview img {
            max-height: 80px;
            border-radius: 12px;
            border: 2px solid #9d4eff;
        }

        .comment-preview-remove {
            position: absolute;
            top: -8px;
            right: -8px;
            width: 22px;
            height: 22px;
            background: #ff4d6d;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #fff;
            font-size: 10px;
            cursor: pointer;
            border: 2px solid #fff;
        }

        /* –ß–ê–¢–´ */
        .chats-tabs {
            display: flex;
            gap: 10px;
            margin: 16px;
            padding: 4px;
            background: #1a1a1a;
            border-radius: 40px;
        }

        .chats-tab {
            flex: 1;
            text-align: center;
            padding: 10px;
            color: #666;
            cursor: pointer;
            border-radius: 30px;
        }

        .chats-tab.active {
            background: #9d4eff;
            color: #fff;
        }

        .chat-item {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 15px;
            margin: 10px 16px;
            background: #1a1a1a;
            border: 1px solid #2a2a2a;
            border-radius: 20px;
            cursor: pointer;
        }

        .chat-avatar {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: #2a2a2a;
            border: 2px solid #9d4eff;
            overflow: hidden;
        }

        .chat-avatar img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .chat-info {
            flex: 1;
        }

        .chat-name {
            font-weight: 600;
            color: #fff;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .chat-last-message {
            color: #666;
            font-size: 13px;
        }

        .chat-time {
            color: #666;
            font-size: 11px;
        }

        .chat-room {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: #000000;
            z-index: 350;
            display: none;
            flex-direction: column;
        }

        .chat-room.active {
            display: flex;
        }

        .chat-room-header {
            padding: 16px;
            border-bottom: 1px solid #2a2a2a;
            display: flex;
            align-items: center;
            gap: 16px;
            background: #1a1a1a;
        }

        .chat-room-header i {
            font-size: 20px;
            color: #9d4eff;
            cursor: pointer;
        }

        .chat-room-name {
            font-size: 18px;
            font-weight: 600;
            flex: 1;
        }

        .chat-messages {
            flex: 1;
            overflow-y: auto;
            padding: 16px;
            background-image: 
                radial-gradient(circle at 10% 20%, rgba(157,78,255,0.05) 0%, transparent 30%),
                radial-gradient(circle at 90% 70%, rgba(255,107,157,0.05) 0%, transparent 30%);
        }

        .chat-message {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
            max-width: 80%;
        }

        .chat-message.own {
            flex-direction: row-reverse;
            margin-left: auto;
        }

        .chat-message-avatar {
            width: 35px;
            height: 35px;
            border-radius: 50%;
            background: #2a2a2a;
            border: 2px solid #9d4eff;
            overflow: hidden;
        }

        .chat-message-avatar img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .chat-message-content {
            background: #1a1a1a;
            border-radius: 18px;
            padding: 10px 14px;
        }

        .chat-message.own .chat-message-content {
            background: #9d4eff;
        }

        .chat-message-sender {
            color: #9d4eff;
            font-size: 12px;
            margin-bottom: 2px;
        }

        .chat-message.own .chat-message-sender {
            color: #fff;
        }

        .chat-message-text {
            color: #fff;
            font-size: 14px;
        }

        .chat-message-image {
            max-width: 200px;
            border-radius: 12px;
            margin: 5px 0;
        }

        .chat-message-image img {
            width: 100%;
            border-radius: 12px;
        }

        .chat-message-time {
            color: #666;
            font-size: 10px;
            margin-top: 4px;
            text-align: right;
        }

        .chat-input-area {
            padding: 16px;
            border-top: 1px solid #2a2a2a;
            background: #1a1a1a;
        }

        .chat-input-wrapper {
            display: flex;
            gap: 10px;
        }

        .chat-input {
            flex: 1;
            background: #2a2a2a;
            border: 1px solid #3a3a3a;
            border-radius: 30px;
            padding: 12px 16px;
            color: #fff;
        }

        .chat-send-btn {
            width: 44px;
            height: 44px;
            background: #9d4eff;
            border: none;
            border-radius: 50%;
            color: #fff;
            cursor: pointer;
        }

        /* –ê–î–ú–ò–ù-–ü–ê–ù–ï–õ–¨ */
        .admin-section {
            background: #1a1a1a;
            border: 2px solid gold;
            border-radius: 30px;
            padding: 20px;
            margin: 16px;
            box-shadow: 0 0 30px gold;
        }

        .admin-title {
            color: gold;
            font-size: 20px;
            font-weight: 700;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .admin-stats {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin-bottom: 20px;
        }

        .admin-stat-card {
            background: #2a2a2a;
            border-radius: 20px;
            padding: 15px;
            text-align: center;
        }

        .admin-stat-number {
            font-size: 28px;
            font-weight: 700;
            color: gold;
        }

        .admin-stat-label {
            font-size: 12px;
            color: #888;
        }

        .admin-user-item {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 15px;
            background: #2a2a2a;
            border-radius: 20px;
            margin-bottom: 10px;
        }

        .admin-user-avatar {
            width: 45px;
            height: 45px;
            border-radius: 50%;
            border: 2px solid gold;
            overflow: hidden;
        }

        .admin-user-avatar img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .admin-user-info {
            flex: 1;
        }

        .admin-user-name {
            font-weight: 600;
            color: #fff;
        }

        .admin-user-username {
            color: gold;
            font-size: 12px;
        }

        .admin-user-actions {
            display: flex;
            gap: 10px;
        }

        .admin-user-btn {
            background: #3a3a3a;
            border: none;
            border-radius: 30px;
            padding: 8px 12px;
            color: #fff;
            font-size: 12px;
            cursor: pointer;
        }

        .admin-user-btn.verify {
            background: #9d4eff;
        }

        .admin-user-btn.ban {
            background: #ff4d6d;
        }

        .admin-user-btn.mute {
            background: #ffaa00;
        }

        .admin-gift-section {
            background: linear-gradient(145deg, #2a1a3a, #1a0a2a);
            border-radius: 30px;
            padding: 20px;
            margin: 16px;
            border: 2px solid gold;
        }

        .gift-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 10px;
            margin: 20px 0;
        }

        .gift-item {
            aspect-ratio: 1;
            background: #2a2a2a;
            border-radius: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 30px;
            cursor: pointer;
            transition: 0.3s;
        }

        .gift-item:hover {
            transform: scale(1.1);
            box-shadow: 0 0 20px gold;
        }

        .gift-item.selected {
            border: 3px solid gold;
            box-shadow: 0 0 30px gold;
        }

        /* –ü–û–î–ê–†–ö–ò –í –ü–†–û–§–ò–õ–ï */
        .profile-gifts {
            display: flex;
            gap: 10px;
            overflow-x: auto;
            padding: 15px;
            margin: 15px 0;
            background: rgba(26,26,26,0.5);
            border-radius: 30px;
        }

        .gift-badge {
            min-width: 60px;
            background: linear-gradient(145deg, #2a1a3a, #1a0a2a);
            border: 2px solid gold;
            border-radius: 20px;
            padding: 10px;
            text-align: center;
        }

        .gift-badge-icon {
            font-size: 30px;
            margin-bottom: 5px;
        }

        .gift-badge-text {
            font-size: 10px;
            color: gold;
        }

        /* –ù–ê–í–ò–ì–ê–¶–ò–Ø */
        .nav {
            position: fixed;
            bottom: 15px;
            left: 50%;
            transform: translateX(-50%);
            width: calc(100% - 30px);
            max-width: 450px;
            height: 65px;
            background: #1a1a1a;
            border: 1px solid #2a2a2a;
            border-radius: 40px;
            display: flex;
            justify-content: space-around;
            align-items: center;
            z-index: 100;
        }

        .nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            color: #666;
            cursor: pointer;
            font-size: 11px;
            padding: 8px 16px;
            border-radius: 30px;
        }

        .nav-item i {
            font-size: 20px;
        }

        .nav-item.active {
            color: #9d4eff;
            background: rgba(157,78,255,0.1);
        }

        .nav-item.admin {
            color: gold;
        }

        .nav-item.admin.active {
            background: rgba(255,215,0,0.2);
        }

        .plus-btn {
            position: fixed;
            bottom: 95px;
            right: 20px;
            width: 56px;
            height: 56px;
            background: #9d4eff;
            border: none;
            border-radius: 50%;
            color: #fff;
            font-size: 28px;
            cursor: pointer;
            z-index: 99;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.95);
            z-index: 200;
            align-items: center;
            justify-content: center;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            width: 90%;
            max-width: 380px;
            background: #1a1a1a;
            border: 1px solid #9d4eff;
            border-radius: 32px;
            padding: 24px;
        }

        .modal-title {
            font-size: 22px;
            font-weight: 600;
            text-align: center;
            margin-bottom: 20px;
        }

        .modal-input {
            width: 100%;
            background: #2a2a2a;
            border: 1px solid #3a3a3a;
            border-radius: 20px;
            padding: 15px;
            color: #fff;
            margin-bottom: 20px;
        }

        .attach-btn {
            background: #2a2a2a;
            border: 2px dashed #9d4eff;
            border-radius: 20px;
            padding: 14px;
            color: #9d4eff;
            text-align: center;
            margin-bottom: 20px;
            cursor: pointer;
        }

        .image-preview {
            width: 100%;
            max-height: 150px;
            border-radius: 16px;
            margin: 10px 0;
            display: none;
            border: 2px solid #9d4eff;
        }

        .modal-buttons {
            display: flex;
            gap: 10px;
        }

        .modal-btn {
            flex: 1;
            padding: 14px;
            border-radius: 25px;
            border: none;
            font-weight: 600;
            cursor: pointer;
        }

        .modal-btn.cancel {
            background: #2a2a2a;
            color: #b3b3b3;
        }

        .modal-btn.submit {
            background: #9d4eff;
            color: #fff;
        }

        .member-item {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 12px;
            border-bottom: 1px solid #2a2a2a;
            cursor: pointer;
        }

        .member-item.selected {
            background: rgba(157,78,255,0.2);
            border-radius: 16px;
        }

        .member-avatar {
            width: 45px;
            height: 45px;
            border-radius: 50%;
            border: 2px solid #9d4eff;
            overflow: hidden;
        }

        .member-checkbox {
            width: 24px;
            height: 24px;
            border: 2px solid #9d4eff;
            border-radius: 50%;
            margin-left: auto;
        }

        .member-checkbox.selected {
            background: #9d4eff;
        }

        .settings-section {
            background: #1a1a1a;
            border: 1px solid #2a2a2a;
            border-radius: 24px;
            padding: 20px;
            margin: 16px;
        }

        .section-title {
            color: #9d4eff;
            font-size: 13px;
            margin-bottom: 15px;
        }

        .settings-item {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 12px 0;
            border-bottom: 1px solid #2a2a2a;
            cursor: pointer;
        }

        .settings-item:last-child {
            border-bottom: none;
        }

        .item-icon {
            width: 40px;
            height: 40px;
            background: #2a2a2a;
            border: 2px solid;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .item-label {
            color: #fff;
            font-size: 16px;
        }

        .item-hint {
            font-size: 12px;
            color: #9d4eff;
        }

        .color-blue { border-color: #4a9eff; color: #4a9eff; }
        .color-purple { border-color: #9d4eff; color: #9d4eff; }
        .color-pink { border-color: #ff6b9d; color: #ff6b9d; }
        .color-green { border-color: #6bff9d; color: #6bff9d; }
        .color-gold { border-color: gold; color: gold; }
    </style>
</head>
<body>
    <div class="stars"></div>
    <div class="bg-decor"></div>

    <!-- –≠–∫—Ä–∞–Ω 1 - –í—Ö–æ–¥ -->
    <div class="page" id="page1">
        <div class="card">
            <h1>clackgram</h1>
            <div class="label">—Ç–µ–ª–µ—Ñ–æ–Ω</div>
            <input type="text" id="phone" placeholder="+7 999 999-99-99" value="">
            <div class="label">–ø–∞—Ä–æ–ª—å</div>
            <input type="password" id="password" placeholder="–º–∏–Ω–∏–º—É–º 8 —Å–∏–º–≤–æ–ª–æ–≤" value="">
            <button id="loginBtn">–í–æ–π—Ç–∏</button>
            <button id="showRegisterBtn" style="margin-top:10px;">–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è</button>
        </div>
        <div class="bottom-text">–¥–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ –∫–æ—Å–º–æ—Å ‚ú¶</div>
    </div>

    <!-- –≠–∫—Ä–∞–Ω 2 - –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è -->
    <div class="page" id="page2">
        <div class="card">
            <div class="avatar-wrap">
                <div class="avatar-circle" id="avatar">
                    <svg viewBox="0 0 64 64">
                        <rect x="4" y="16" width="56" height="36" rx="4" fill="none" stroke="currentColor" stroke-width="2"/>
                        <circle cx="32" cy="34" r="10" fill="none" stroke="currentColor" stroke-width="2"/>
                        <rect x="14" y="10" width="8" height="6" rx="1" fill="none" stroke="currentColor" stroke-width="2"/>
                    </svg>
                </div>
            </div>
            <input type="file" id="fileInput" accept="image/*">
            <input type="text" id="name" placeholder="—Ç–≤–æ–µ –∏–º—è">
            <input type="text" id="username" placeholder="@username">
            <div class="error" id="usernameError">@username —É–∂–µ –∑–∞–Ω—è—Ç</div>
            <button id="registerBtn">–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è</button>
            <button id="backToLoginBtn" style="margin-top:10px;">–ù–∞–∑–∞–¥</button>
        </div>
    </div>

    <!-- –û—Å–Ω–æ–≤–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ -->
    <div class="app" id="app">
        <div class="loading" id="loading">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
        
        <!-- –õ–µ–Ω—Ç–∞ -->
        <div class="screen active" id="feedScreen">
            <div class="screen-header">
                <div class="screen-title">–õ–µ–Ω—Ç–∞</div>
            </div>
            <div id="feedPosts"></div>
        </div>

        <!-- –ü—Ä–æ—Ñ–∏–ª—å -->
        <div class="screen" id="profileScreen">
            <div class="screen-header">
                <div class="screen-title">–ü—Ä–æ—Ñ–∏–ª—å</div>
            </div>
            <div id="profileContent"></div>
        </div>

        <!-- –ß–∞—Ç—ã -->
        <div class="screen" id="chatsScreen">
            <div class="screen-header">
                <div class="screen-title">–ß–∞—Ç—ã</div>
                <i class="fas fa-plus add-button" id="createGroupBtn"></i>
                <i class="fas fa-search search-button" id="searchUsersBtn"></i>
            </div>
            
            <div class="chats-tabs">
                <div class="chats-tab active" data-chat-tab="personal">–õ–∏—á–Ω—ã–µ</div>
                <div class="chats-tab" data-chat-tab="groups">–ì—Ä—É–ø–ø—ã</div>
            </div>
            
            <div id="personalChats" class="chats-list"></div>
            <div id="groupChats" style="display: none;" class="chats-list"></div>
        </div>

        <!-- –ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å -->
        <div class="screen" id="adminScreen">
            <div class="screen-header">
                <i class="fas fa-arrow-left back-button" id="backFromAdmin"></i>
                <div class="screen-title">–ê–¥–º–∏–Ω –ø–∞–Ω–µ–ª—å</div>
                <i class="fas fa-crown" style="color:gold;"></i>
            </div>
            
            <div class="admin-section">
                <div class="admin-title">
                    <i class="fas fa-chart-line"></i> –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
                </div>
                <div class="admin-stats">
                    <div class="admin-stat-card">
                        <div class="admin-stat-number" id="adminUserCount">0</div>
                        <div class="admin-stat-label">–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π</div>
                    </div>
                    <div class="admin-stat-card">
                        <div class="admin-stat-number" id="adminPostCount">0</div>
                        <div class="admin-stat-label">–ø–æ—Å—Ç–æ–≤</div>
                    </div>
                    <div class="admin-stat-card">
                        <div class="admin-stat-number" id="adminMessageCount">0</div>
                        <div class="admin-stat-label">—Å–æ–æ–±—â–µ–Ω–∏–π</div>
                    </div>
                    <div class="admin-stat-card">
                        <div class="admin-stat-number" id="adminGiftCount">0</div>
                        <div class="admin-stat-label">–ø–æ–¥–∞—Ä–∫–æ–≤</div>
                    </div>
                </div>
            </div>
            
            <div class="admin-gift-section">
                <div class="admin-title">
                    <i class="fas fa-gift"></i> –ü–æ–¥–∞—Ä–∫–∏
                </div>
                
                <div class="gift-grid">
                    <div class="gift-item" onclick="selectGift('‚ù§Ô∏è')">‚ù§Ô∏è</div>
                    <div class="gift-item" onclick="selectGift('üåü')">üåü</div>
                    <div class="gift-item" onclick="selectGift('üéÅ')">üéÅ</div>
                    <div class="gift-item" onclick="selectGift('üèÜ')">üèÜ</div>
                    <div class="gift-item" onclick="selectGift('üíé')">üíé</div>
                    <div class="gift-item" onclick="selectGift('üëë')">üëë</div>
                    <div class="gift-item" onclick="selectGift('üéÇ')">üéÇ</div>
                    <div class="gift-item" onclick="selectGift('üåà')">üåà</div>
                </div>
                
                <input type="text" class="modal-input" id="giftUsername" placeholder="@username –ø–æ–ª—É—á–∞—Ç–µ–ª—è" style="margin-bottom:10px;">
                <input type="text" class="modal-input" id="giftMessage" placeholder="—Ç–µ–∫—Å—Ç –ø–æ–¥–∞—Ä–∫–∞">
                <button class="modal-btn submit" onclick="sendGift()" style="width:100%; background:gold; color:#000;">üéÅ –û—Ç–ø—Ä–∞–≤–∏—Ç—å –ø–æ–¥–∞—Ä–æ–∫</button>
            </div>
            
            <div class="admin-section">
                <div class="admin-title">
                    <i class="fas fa-users-crown"></i> –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏
                </div>
                <div id="adminUserList"></div>
            </div>
        </div>

        <!-- –ü—Ä–æ—Ñ–∏–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è -->
        <div class="screen" id="userProfileScreen">
            <div class="screen-header">
                <i class="fas fa-arrow-left back-button" id="backFromUserProfile"></i>
                <div class="screen-title">–ü—Ä–æ—Ñ–∏–ª—å</div>
            </div>
            <div id="userProfileContent"></div>
        </div>

        <!-- –ù–∞—Å—Ç—Ä–æ–π–∫–∏ -->
        <div class="screen" id="settingsScreen">
            <div class="screen-header">
                <i class="fas fa-arrow-left back-button" id="backFromSettings"></i>
                <div class="screen-title">–ù–∞—Å—Ç—Ä–æ–π–∫–∏</div>
            </div>

            <div class="settings-section">
                <div class="section-title">–∞–∫–∫–∞—É–Ω—Ç</div>
                <div class="settings-item" id="accountSettingsBtn">
                    <div class="item-icon color-blue">
                        <i class="fas fa-user"></i>
                    </div>
                    <div class="item-content">
                        <div class="item-label">–ê–∫–∫–∞—É–Ω—Ç</div>
                        <div class="item-hint">–ª–∏—á–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –∞–∫–∫–∞—É–Ω—Ç–∞ -->
        <div class="screen" id="accountSettingsScreen">
            <div class="screen-header">
                <i class="fas fa-arrow-left back-button" id="backFromAccount"></i>
                <div class="screen-title">–ê–∫–∫–∞—É–Ω—Ç</div>
            </div>

            <div class="settings-section">
                <div class="section-title">–∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –≤–∞—Å</div>
                
                <div class="settings-item" id="changePhoneBtn">
                    <div class="item-icon color-blue">
                        <i class="fas fa-phone"></i>
                    </div>
                    <div class="item-content">
                        <div class="item-label" id="phoneDisplay">+7 999 999-99-99</div>
                        <div class="item-hint">–Ω–∞–∂–º–∏—Ç–µ, —á—Ç–æ–±—ã –∏–∑–º–µ–Ω–∏—Ç—å</div>
                    </div>
                </div>

                <div class="settings-item" id="changeUsernameBtn">
                    <div class="item-icon color-purple">
                        <i class="fas fa-at"></i>
                    </div>
                    <div class="item-content">
                        <div class="item-label" id="usernameDisplay">@username</div>
                        <div class="item-hint">–Ω–∞–∂–º–∏—Ç–µ, —á—Ç–æ–±—ã –∏–∑–º–µ–Ω–∏—Ç—å</div>
                    </div>
                </div>

                <div class="settings-item" id="changeBirthdayBtn">
                    <div class="item-icon color-pink">
                        <i class="fas fa-birthday-cake"></i>
                    </div>
                    <div class="item-content">
                        <div class="item-label" id="birthdayDisplay">–Ω–µ —É–∫–∞–∑–∞–Ω</div>
                        <div class="item-hint">—É–∫–∞–∂–∏—Ç–µ –¥–µ–Ω—å —Ä–æ–∂–¥–µ–Ω–∏—è</div>
                    </div>
                </div>

                <div class="settings-item" id="changeFirstNameBtn">
                    <div class="item-icon color-green">
                        <i class="fas fa-user"></i>
                    </div>
                    <div class="item-content">
                        <div class="item-label" id="firstNameDisplay">–ò–º—è</div>
                        <div class="item-hint">–Ω–∞–∂–º–∏—Ç–µ, —á—Ç–æ–±—ã –∏–∑–º–µ–Ω–∏—Ç—å</div>
                    </div>
                </div>

                <div class="settings-item" id="changeLastNameBtn">
                    <div class="item-icon color-blue">
                        <i class="fas fa-user"></i>
                    </div>
                    <div class="item-content">
                        <div class="item-label" id="lastNameDisplay">–Ω–µ —É–∫–∞–∑–∞–Ω–∞</div>
                        <div class="item-hint">—Ñ–∞–º–∏–ª–∏—è (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)</div>
                    </div>
                </div>
            </div>

            <div class="settings-section">
                <div class="section-title">–æ —Å–µ–±–µ</div>
                <div class="settings-item" id="changeBioBtn">
                    <div class="item-icon color-purple">
                        <i class="fas fa-pen"></i>
                    </div>
                    <div class="item-content">
                        <div class="item-label" id="bioDisplay">‚Äî</div>
                        <div class="item-hint">–Ω–∞–ø–∏—à–∏—Ç–µ –æ —Å–µ–±–µ</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- –ù–∞–≤–∏–≥–∞—Ü–∏—è -->
        <div class="nav">
            <div class="nav-item active" data-screen="feed">
                <i class="fas fa-home"></i>
                <span>–ª–µ–Ω—Ç–∞</span>
            </div>
            <div class="nav-item" data-screen="profile">
                <i class="fas fa-user"></i>
                <span>–ø—Ä–æ—Ñ–∏–ª—å</span>
            </div>
            <div class="nav-item" data-screen="chats">
                <i class="fas fa-comment"></i>
                <span>—á–∞—Ç—ã</span>
            </div>
            <div class="nav-item admin" data-screen="admin" id="adminNavItem" style="display:none;">
                <i class="fas fa-crown" style="color:gold;"></i>
                <span>–∞–¥–º–∏–Ω</span>
            </div>
            <div class="nav-item" data-screen="settings">
                <i class="fas fa-cog"></i>
                <span>–Ω–∞—Å—Ç—Ä–æ–π–∫–∏</span>
            </div>
        </div>

        <button class="plus-btn" id="plusBtn">+</button>
    </div>

    <!-- –ß–∞—Ç-–∫–æ–º–Ω–∞—Ç–∞ -->
    <div class="chat-room" id="chatRoom">
        <div class="chat-room-header">
            <i class="fas fa-arrow-left" id="closeChat"></i>
            <div class="chat-room-name" id="chatRoomName">–ß–∞—Ç</div>
        </div>
        <div class="chat-messages" id="chatMessages"></div>
        <div class="chat-input-area">
            <div class="chat-input-wrapper">
                <input type="text" class="chat-input" id="chatInput" placeholder="–Ω–∞–ø–∏—à–∏ —Å–æ–æ–±—â–µ–Ω–∏–µ...">
                <button class="chat-send-btn" id="sendChatMessage"><i class="fas fa-paper-plane"></i></button>
            </div>
        </div>
    </div>

    <!-- –ú–æ–¥–∞–ª–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è –ø–æ—Å—Ç–∞ -->
    <div class="modal" id="postModal">
        <div class="modal-content">
            <div class="modal-title">–Ω–æ–≤—ã–π –ø–æ—Å—Ç</div>
            <textarea class="modal-textarea" id="postText" placeholder="—á—Ç–æ —É —Ç–µ–±—è –Ω–æ–≤–æ–≥–æ?"></textarea>
            <div class="attach-btn" id="attachImageBtn">
                <i class="fas fa-image"></i> –¥–æ–±–∞–≤–∏—Ç—å —Ñ–æ—Ç–æ
            </div>
            <input type="file" id="imageInput" accept="image/*">
            <img id="imagePreview" class="image-preview">
            <div class="modal-buttons">
                <button class="modal-btn cancel" id="cancelPost">–æ—Ç–º–µ–Ω–∞</button>
                <button class="modal-btn submit" id="submitPost">–æ–ø—É–±–ª–∏–∫–æ–≤–∞—Ç—å</button>
            </div>
        </div>
    </div>

    <!-- –ú–æ–¥–∞–ª–∫–∞ –ø–æ–∏—Å–∫–∞ -->
    <div class="modal" id="searchModal">
        <div class="modal-content">
            <div class="modal-title">–ø–æ–∏—Å–∫</div>
            <input type="text" class="modal-input" id="searchInput" placeholder="@username">
            <div class="modal-buttons">
                <button class="modal-btn cancel" id="cancelSearch">–æ—Ç–º–µ–Ω–∞</button>
                <button class="modal-btn submit" id="submitSearch">–Ω–∞–π—Ç–∏</button>
            </div>
        </div>
    </div>

    <!-- –ú–æ–¥–∞–ª–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è –≥—Ä—É–ø–ø—ã -->
    <div class="modal" id="createGroupModal">
        <div class="modal-content">
            <div class="modal-title">—Å–æ–∑–¥–∞—Ç—å –≥—Ä—É–ø–ø—É</div>
            <input type="text" class="modal-input" id="groupName" placeholder="–Ω–∞–∑–≤–∞–Ω–∏–µ –≥—Ä—É–ø–ø—ã">
            <div style="color: #9d4eff; margin: 10px 0;">–≤—ã–±–µ—Ä–∏—Ç–µ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤</div>
            <div id="groupMembersList" style="max-height:300px; overflow-y:auto; margin-bottom:20px;"></div>
            <div class="modal-buttons">
                <button class="modal-btn cancel" id="cancelGroup">–æ—Ç–º–µ–Ω–∞</button>
                <button class="modal-btn submit" id="createGroup">—Å–æ–∑–¥–∞—Ç—å</button>
            </div>
        </div>
    </div>

    <!-- –ú–æ–¥–∞–ª–∫–∞ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤ -->
    <div class="modal" id="commentsModal">
        <div class="modal-content">
            <div class="modal-title">–∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏</div>
            <div id="commentsList" style="max-height: 300px; overflow-y: auto; margin-bottom: 20px;"></div>
            <div style="display: flex; gap: 10px;">
                <div class="comment-attach-btn" id="commentAttachBtn">
                    <i class="fas fa-image"></i>
                </div>
                <input type="file" id="commentImageInput" accept="image/*" style="display: none;">
                <input type="text" class="comment-input-field" id="commentInput" placeholder="–Ω–∞–ø–∏—à–∏ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π..." style="flex:1; margin:0;">
                <button class="comment-send-btn" id="sendComment" style="width:44px;">‚Üí</button>
            </div>
            <div id="commentPreviewContainer" class="comment-preview" style="display: none;">
                <img id="commentImagePreview">
                <div class="comment-preview-remove" id="removeCommentImage">√ó</div>
            </div>
        </div>
    </div>

    <!-- –ú–æ–¥–∞–ª–∫–∞ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è -->
    <div class="modal" id="editModal">
        <div class="modal-content">
            <div class="modal-title" id="editModalTitle">–∏–∑–º–µ–Ω–∏—Ç—å</div>
            <input type="text" class="modal-input" id="editInput" placeholder="">
            <div class="modal-buttons">
                <button class="modal-btn cancel" id="cancelEdit">–æ—Ç–º–µ–Ω–∞</button>
                <button class="modal-btn submit" id="submitEdit">—Å–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
            </div>
        </div>
    </div>

    <!-- –ú–û–î–ê–õ–ö–ê –î–õ–Ø –ë–ê–ù–ù–ï–†–ê (–í–ê–ñ–ù–û!) -->
    <div class="modal" id="bannerModal">
        <div class="modal-content">
            <div class="modal-title">–∑–∞–≥—Ä—É–∑–∏—Ç—å –±–∞–Ω–Ω–µ—Ä</div>
            <input type="file" id="bannerInput" accept="image/*">
            <div class="attach-btn" id="attachBannerBtn">
                <i class="fas fa-image"></i> –≤—ã–±—Ä–∞—Ç—å —Ñ–æ—Ç–æ
            </div>
            <img id="bannerPreview" class="image-preview">
            <div class="modal-buttons">
                <button class="modal-btn cancel" id="cancelBanner">–æ—Ç–º–µ–Ω–∞</button>
                <button class="modal-btn submit" id="submitBanner">—Å–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
            </div>
        </div>
    </div>

    <script>
        // üî• –¢–í–û–ò –î–ê–ù–ù–´–ï FIREBASE
        const firebaseConfig = {
            apiKey: "AIzaSyA1Xo2bvcwbDl85X-9h6lxaBJd6YYTRcqc",
            authDomain: "clackgram-89cf0.firebaseapp.com",
            projectId: "clackgram-89cf0",
            storageBucket: "clackgram-89cf0.firebasestorage.app",
            messagingSenderId: "132550332300",
            appId: "1:132550332300:web:f69aee57c11a62a2b5d0a9"
        };

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Firebase
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();
        const auth = firebase.auth();

        // üî• –ê–î–ú–ò–ù–´ (—Ç–æ–ª—å–∫–æ @admin —Ç–µ–ø–µ—Ä—å –∞–¥–º–∏–Ω)
        const ADMINS = ['@admin'];

        // –î–∞–Ω–Ω—ã–µ
        let user = null;
        let allUsers = [];
        let posts = [];
        let personalChats = [];
        let groupChats = [];
        let currentPostId = null;
        let currentChat = null;
        let selectedGift = '‚ù§Ô∏è';
        let currentImageData = '';
        let currentCommentImage = null;

        // –§—É–Ω–∫—Ü–∏—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –∞–¥–º–∏–Ω–∞
        function isAdmin(username) {
            return ADMINS.includes(username);
        }

        function getVerifiedBadge(username) {
            return isAdmin(username) ? '<i class="fas fa-check-circle verified-badge"></i>' : '';
        }

        // –ü—Ä–æ–≤–µ—Ä–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
        auth.onAuthStateChanged(async (authUser) => {
            if (authUser) {
                document.getElementById('loading').style.display = 'block';
                
                const userDoc = await db.collection('users').doc(authUser.uid).get();
                if (userDoc.exists) {
                    user = { uid: authUser.uid, ...userDoc.data() };
                }
                
                await loadAllUsers();
                await loadPosts();
                
                document.getElementById('page1').style.display = 'none';
                document.getElementById('page2').style.display = 'none';
                document.getElementById('loading').style.display = 'none';
                document.getElementById('app').style.display = 'block';
                
                if (isAdmin(user.username)) {
                    document.getElementById('adminNavItem').style.display = 'flex';
                    updateAdminStats();
                    renderAdminUserList();
                }
                
                renderFeed();
                renderProfile();
                renderChats();
            } else {
                document.getElementById('page1').style.display = 'flex';
                document.getElementById('page2').style.display = 'none';
                document.getElementById('app').style.display = 'none';
                document.getElementById('loading').style.display = 'none';
            }
        });

        // –ó–∞–≥—Ä—É–∑–∫–∞ –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
        async function loadAllUsers() {
            const snapshot = await db.collection('users').get();
            allUsers = snapshot.docs.map(doc => ({ uid: doc.id, ...doc.data() }));
        }

        // –ó–∞–≥—Ä—É–∑–∫–∞ –ø–æ—Å—Ç–æ–≤
        async function loadPosts() {
            const snapshot = await db.collection('posts').orderBy('createdAt', 'desc').get();
            posts = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
        }

        // –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è
        async function registerUser(email, password, name, username, avatar) {
            try {
                const userCredential = await auth.createUserWithEmailAndPassword(email, password);
                const authUser = userCredential.user;
                
                const userData = {
                    name: name,
                    username: username,
                    avatar: avatar || '',
                    banner: '', // ‚Üê –í–ê–ñ–ù–û! –î–æ–±–∞–≤–ª—è–µ–º –ø–æ–ª–µ –¥–ª—è –±–∞–Ω–Ω–µ—Ä–∞
                    lastName: '',
                    bio: '',
                    birthday: '',
                    status: '–æ–Ω–ª–∞–π–Ω',
                    email: email,
                    phone: phoneInput.value,
                    gifts: []
                };
                
                await db.collection('users').doc(authUser.uid).set(userData);
                return { success: true };
            } catch (error) {
                return { success: false, error: error.message };
            }
        }

        // –°–æ–∑–¥–∞–Ω–∏–µ –ø–æ—Å—Ç–∞
        async function createPost(content, imageData) {
            try {
                const postData = {
                    userId: user.uid,
                    user: user.username,
                    userName: user.name,
                    userAvatar: user.avatar,
                    content: content,
                    image: imageData || '',
                    time: new Date().toLocaleString('ru-RU', { hour: '2-digit', minute: '2-digit' }),
                    likes: 0,
                    likedBy: [],
                    comments: [],
                    pinned: false,
                    createdAt: firebase.firestore.FieldValue.serverTimestamp()
                };
                
                await db.collection('posts').add(postData);
                await loadPosts();
                renderFeed();
                return { success: true };
            } catch (error) {
                return { success: false, error: error.message };
            }
        }

        // –£–¥–∞–ª–µ–Ω–∏–µ –ø–æ—Å—Ç–∞ (–∞–¥–º–∏–Ω –º–æ–∂–µ—Ç —É–¥–∞–ª–∏—Ç—å –ª—é–±–æ–π)
        async function deletePost(postId, postUserId) {
            if (user.uid === postUserId || isAdmin(user.username)) {
                await db.collection('posts').doc(postId).delete();
                await loadPosts();
                renderFeed();
                renderProfile();
            }
        }

        // –õ–∞–π–∫ –ø–æ—Å—Ç–∞
        async function likePost(postId) {
            const postRef = db.collection('posts').doc(postId);
            const postDoc = await postRef.get();
            const postData = postDoc.data();
            
            let likedBy = postData.likedBy || [];
            let likes = postData.likes || 0;
            
            if (likedBy.includes(user.uid)) {
                likedBy = likedBy.filter(id => id !== user.uid);
                likes -= 1;
            } else {
                likedBy.push(user.uid);
                likes += 1;
            }
            
            await postRef.update({ likes, likedBy });
            await loadPosts();
            renderFeed();
        }

        // –ó–∞–∫—Ä–µ–ø–ª–µ–Ω–∏–µ –ø–æ—Å—Ç–∞
        async function pinPost(postId) {
            const postRef = db.collection('posts').doc(postId);
            const postDoc = await postRef.get();
            const postData = postDoc.data();
            
            if (postData.userId === user.uid) {
                await postRef.update({ pinned: !postData.pinned });
                await loadPosts();
                renderFeed();
                renderProfile();
            }
        }

        // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è
        async function addComment(postId, text, image) {
            try {
                const postRef = db.collection('posts').doc(postId);
                const postDoc = await postRef.get();
                const comments = postDoc.data().comments || [];
                
                const newComment = {
                    userId: user.uid,
                    user: user.username,
                    userName: user.name,
                    userAvatar: user.avatar,
                    text: text,
                    image: image || '',
                    time: new Date().toLocaleString('ru-RU', { hour: '2-digit', minute: '2-digit' }),
                    likes: 0,
                    likedBy: [],
                    pinned: false
                };
                
                comments.push(newComment);
                await postRef.update({ comments: comments });
                renderCommentsList(comments);
                return { success: true };
            } catch (error) {
                return { success: false, error: error.message };
            }
        }

        // –£–¥–∞–ª–µ–Ω–∏–µ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è (–∞–¥–º–∏–Ω –º–æ–∂–µ—Ç —É–¥–∞–ª–∏—Ç—å –ª—é–±–æ–π)
        async function deleteComment(postId, commentIndex) {
            const postRef = db.collection('posts').doc(postId);
            const postDoc = await postRef.get();
            const comments = postDoc.data().comments || [];
            
            if (comments[commentIndex].userId === user.uid || isAdmin(user.username)) {
                comments.splice(commentIndex, 1);
                await postRef.update({ comments: comments });
                renderCommentsList(comments);
            }
        }

        // –ó–∞–∫—Ä–µ–ø–ª–µ–Ω–∏–µ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è
        async function pinComment(postId, commentIndex) {
            const postRef = db.collection('posts').doc(postId);
            const postDoc = await postRef.get();
            const postData = postDoc.data();
            const comments = postData.comments || [];
            
            if (postData.userId === user.uid) {
                for (let i = 0; i < comments.length; i++) {
                    comments[i].pinned = false;
                }
                comments[commentIndex].pinned = true;
                await postRef.update({ comments: comments });
                renderCommentsList(comments);
            }
        }

        // –õ–∞–π–∫ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è
        async function likeComment(postId, commentIndex) {
            const postRef = db.collection('posts').doc(postId);
            const postDoc = await postRef.get();
            const comments = postDoc.data().comments || [];
            const comment = comments[commentIndex];
            
            let likedBy = comment.likedBy || [];
            let likes = comment.likes || 0;
            
            if (likedBy.includes(user.uid)) {
                likedBy = likedBy.filter(id => id !== user.uid);
                likes -= 1;
            } else {
                likedBy.push(user.uid);
                likes += 1;
            }
            
            comment.likedBy = likedBy;
            comment.likes = likes;
            
            await postRef.update({ comments: comments });
            renderCommentsList(comments);
        }

        // –û—Ç–ø—Ä–∞–≤–∫–∞ –ø–æ–¥–∞—Ä–∫–∞ (—Ç–æ–ª—å–∫–æ –∞–¥–º–∏–Ω)
        async function sendGift() {
            if (!isAdmin(user.username)) {
                alert('–¢–æ–ª—å–∫–æ –∞–¥–º–∏–Ω –º–æ–∂–µ—Ç –¥–∞—Ä–∏—Ç—å –ø–æ–¥–∞—Ä–∫–∏');
                return;
            }
            
            let username = document.getElementById('giftUsername').value.trim();
            let message = document.getElementById('giftMessage').value.trim();
            
            if (!username) {
                alert('–í–≤–µ–¥–∏—Ç–µ username –ø–æ–ª—É—á–∞—Ç–µ–ª—è');
                return;
            }
            
            const userSnapshot = await db.collection('users').where('username', '==', username).get();
            if (userSnapshot.empty) {
                alert('–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –Ω–∞–π–¥–µ–Ω');
                return;
            }
            
            const recipientRef = userSnapshot.docs[0].ref;
            const recipientData = userSnapshot.docs[0].data();
            const gifts = recipientData.gifts || [];
            
            gifts.push({
                icon: selectedGift,
                text: message || 'üéÅ –ü–æ–¥–∞—Ä–æ–∫',
                from: user.username,
                date: new Date().toLocaleDateString()
            });
            
            await recipientRef.update({ gifts: gifts });
            
            alert(`–ü–æ–¥–∞—Ä–æ–∫ ${selectedGift} –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é ${username}!`);
            document.getElementById('giftUsername').value = '';
            document.getElementById('giftMessage').value = '';
            updateAdminStats();
        }

        // –í—ã–±–æ—Ä –ø–æ–¥–∞—Ä–∫–∞
        window.selectGift = function(gift) {
            selectedGift = gift;
            document.querySelectorAll('.gift-item').forEach(item => {
                item.classList.remove('selected');
                if (item.textContent === gift) {
                    item.classList.add('selected');
                }
            });
        };

        // DOM —ç–ª–µ–º–µ–Ω—Ç—ã
        const page1 = document.getElementById('page1');
        const page2 = document.getElementById('page2');
        const app = document.getElementById('app');
        const loading = document.getElementById('loading');

        const phoneInput = document.getElementById('phone');
        const passInput = document.getElementById('password');
        const loginBtn = document.getElementById('loginBtn');
        const showRegisterBtn = document.getElementById('showRegisterBtn');
        const backToLoginBtn = document.getElementById('backToLoginBtn');

        const avatar = document.getElementById('avatar');
        const fileInput = document.getElementById('fileInput');
        const nameInput = document.getElementById('name');
        const usernameInput = document.getElementById('username');
        const registerBtn = document.getElementById('registerBtn');
        const usernameError = document.getElementById('usernameError');

        const feedPosts = document.getElementById('feedPosts');
        const profileContent = document.getElementById('profileContent');
        const userProfileContent = document.getElementById('userProfileContent');
        const adminUserList = document.getElementById('adminUserList');

        const navItems = document.querySelectorAll('.nav-item');
        const screens = document.querySelectorAll('.screen');
        const adminNavItem = document.getElementById('adminNavItem');

        const plusBtn = document.getElementById('plusBtn');
        const postModal = document.getElementById('postModal');
        const cancelPost = document.getElementById('cancelPost');
        const submitPost = document.getElementById('submitPost');
        const postText = document.getElementById('postText');
        const attachImageBtn = document.getElementById('attachImageBtn');
        const imageInput = document.getElementById('imageInput');
        const imagePreview = document.getElementById('imagePreview');

        const searchModal = document.getElementById('searchModal');
        const searchInput = document.getElementById('searchInput');
        const cancelSearch = document.getElementById('cancelSearch');
        const submitSearch = document.getElementById('submitSearch');

        const createGroupModal = document.getElementById('createGroupModal');
        const groupName = document.getElementById('groupName');
        const groupMembersList = document.getElementById('groupMembersList');
        const cancelGroup = document.getElementById('cancelGroup');
        const createGroup = document.getElementById('createGroup');

        const commentsModal = document.getElementById('commentsModal');
        const commentsList = document.getElementById('commentsList');
        const commentInput = document.getElementById('commentInput');
        const sendComment = document.getElementById('sendComment');
        const commentAttachBtn = document.getElementById('commentAttachBtn');
        const commentImageInput = document.getElementById('commentImageInput');
        const commentImagePreview = document.getElementById('commentImagePreview');
        const commentPreviewContainer = document.getElementById('commentPreviewContainer');
        const removeCommentImage = document.getElementById('removeCommentImage');

        const editModal = document.getElementById('editModal');
        const editInput = document.getElementById('editInput');
        const cancelEdit = document.getElementById('cancelEdit');
        const submitEdit = document.getElementById('submitEdit');
        const editModalTitle = document.getElementById('editModalTitle');

        // –≠–ª–µ–º–µ–Ω—Ç—ã –¥–ª—è –±–∞–Ω–Ω–µ—Ä–∞
        const bannerModal = document.getElementById('bannerModal');
        const bannerInput = document.getElementById('bannerInput');
        const attachBannerBtn = document.getElementById('attachBannerBtn');
        const bannerPreview = document.getElementById('bannerPreview');
        const cancelBanner = document.getElementById('cancelBanner');
        const submitBanner = document.getElementById('submitBanner');

        const chatRoom = document.getElementById('chatRoom');
        const closeChat = document.getElementById('closeChat');
        const chatRoomName = document.getElementById('chatRoomName');
        const chatMessages = document.getElementById('chatMessages');
        const chatInput = document.getElementById('chatInput');
        const sendChatMessage = document.getElementById('sendChatMessage');

        const personalChatsDiv = document.getElementById('personalChats');
        const groupChatsDiv = document.getElementById('groupChats');
        const chatTabs = document.querySelectorAll('.chats-tab');
        const createGroupBtn = document.getElementById('createGroupBtn');
        const searchUsersBtn = document.getElementById('searchUsersBtn');

        let currentEditField = '';

        // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –º–µ–∂–¥—É —ç–∫—Ä–∞–Ω–∞–º–∏
        showRegisterBtn.addEventListener('click', function() {
            page1.style.display = 'none';
            page2.style.display = 'flex';
        });

        backToLoginBtn.addEventListener('click', function() {
            page2.style.display = 'none';
            page1.style.display = 'flex';
        });

        // –ê–≤–∞—Ç–∞—Ä
        avatar.addEventListener('click', function() {
            fileInput.click();
        });

        fileInput.addEventListener('change', function(e) {
            let file = e.target.files[0];
            if (file) {
                let reader = new FileReader();
                reader.onload = function(event) {
                    let img = document.createElement('img');
                    img.src = event.target.result;
                    avatar.innerHTML = '';
                    avatar.appendChild(img);
                    currentImageData = event.target.result;
                };
                reader.readAsDataURL(file);
            }
        });

        // –ü—Ä–æ–≤–µ—Ä–∫–∞ username
        async function checkUsername() {
            let name = nameInput.value.trim();
            let username = usernameInput.value.trim();
            let validUsername = username.startsWith('@') && username.length > 1;
            
            const snapshot = await db.collection('users').where('username', '==', username).get();
            let taken = !snapshot.empty;
            
            usernameError.style.display = taken ? 'block' : 'none';
            
            if (name && validUsername && !taken) {
                registerBtn.classList.add('active');
            } else {
                registerBtn.classList.remove('active');
            }
        }

        nameInput.addEventListener('input', checkUsername);
        usernameInput.addEventListener('input', checkUsername);

        // –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è
        registerBtn.addEventListener('click', async function() {
            if (!registerBtn.classList.contains('active')) {
                alert('–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –∏–º—è –∏ @username');
                return;
            }
            
            const email = phoneInput.value + '@clackgram.com';
            const password = passInput.value;
            
            loading.style.display = 'block';
            page2.style.display = 'none';
            
            const result = await registerUser(email, password, nameInput.value, usernameInput.value, currentImageData);
            
            if (!result.success) {
                loading.style.display = 'none';
                page2.style.display = 'flex';
                alert('–û—à–∏–±–∫–∞: ' + result.error);
            }
        });

        // –í—Ö–æ–¥
        loginBtn.addEventListener('click', async function() {
            const email = phoneInput.value + '@clackgram.com';
            const password = passInput.value;
            
            loading.style.display = 'block';
            page1.style.display = 'none';
            
            try {
                await auth.signInWithEmailAndPassword(email, password);
            } catch (error) {
                loading.style.display = 'none';
                page1.style.display = 'flex';
                
                if (error.code === 'auth/user-not-found') {
                    if (confirm('–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –Ω–∞–π–¥–µ–Ω. –•–æ—Ç–∏—Ç–µ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è?')) {
                        page1.style.display = 'none';
                        page2.style.display = 'flex';
                    }
                } else {
                    alert('–û—à–∏–±–∫–∞: ' + error.message);
                }
            }
        });

        // –ù–∞–≤–∏–≥–∞—Ü–∏—è
        for (let i = 0; i < navItems.length; i++) {
            navItems[i].addEventListener('click', function() {
                for (let j = 0; j < navItems.length; j++) {
                    navItems[j].classList.remove('active');
                }
                this.classList.add('active');
                
                let screenId = this.dataset.screen + 'Screen';
                for (let j = 0; j < screens.length; j++) {
                    screens[j].classList.remove('active');
                }
                document.getElementById(screenId).classList.add('active');
                
                if (this.dataset.screen === 'feed') {
                    renderFeed();
                }
                if (this.dataset.screen === 'profile') {
                    renderProfile();
                }
                if (this.dataset.screen === 'chats') {
                    renderChats();
                }
                if (this.dataset.screen === 'admin') {
                    updateAdminStats();
                    renderAdminUserList();
                }
            });
        }

        // –ù–∞–∑–∞–¥ –∏–∑ –∞–¥–º–∏–Ω–∫–∏
        document.getElementById('backFromAdmin').addEventListener('click', function() {
            document.getElementById('feedScreen').classList.add('active');
            document.getElementById('adminScreen').classList.remove('active');
            navItems[0].classList.add('active');
            navItems[3].classList.remove('active');
        });

        document.getElementById('backFromSettings').addEventListener('click', function() {
            document.getElementById('profileScreen').classList.add('active');
            document.getElementById('settingsScreen').classList.remove('active');
            navItems[1].classList.add('active');
            navItems[4].classList.remove('active');
        });

        document.getElementById('backFromAccount').addEventListener('click', function() {
            document.getElementById('settingsScreen').classList.add('active');
            document.getElementById('accountSettingsScreen').classList.remove('active');
        });

        document.getElementById('backFromUserProfile').addEventListener('click', function() {
            document.getElementById('chatsScreen').classList.add('active');
            document.getElementById('userProfileScreen').classList.remove('active');
            navItems[2].classList.add('active');
        });

        closeChat.addEventListener('click', function() {
            chatRoom.classList.remove('active');
        });

        // ===== –§–£–ù–ö–¶–ò–ò –î–õ–Ø –ë–ê–ù–ù–ï–†–ê (–†–ê–ë–û–¢–ê–Æ–¢!) =====
        if (attachBannerBtn) {
            attachBannerBtn.addEventListener('click', function() {
                bannerInput.click();
            });

            bannerInput.addEventListener('change', function(e) {
                let file = e.target.files[0];
                if (file) {
                    let reader = new FileReader();
                    reader.onload = function(event) {
                        bannerPreview.src = event.target.result;
                        bannerPreview.style.display = 'block';
                    };
                    reader.readAsDataURL(file);
                }
            });

            cancelBanner.addEventListener('click', function() {
                bannerModal.classList.remove('active');
                bannerPreview.style.display = 'none';
                bannerPreview.src = '';
            });

            submitBanner.addEventListener('click', async function() {
                if (bannerPreview.src) {
                    user.banner = bannerPreview.src;
                    if (user.uid) {
                        await db.collection('users').doc(user.uid).update({ banner: bannerPreview.src });
                    }
                    renderProfile();
                    bannerModal.classList.remove('active');
                    bannerPreview.style.display = 'none';
                    bannerPreview.src = '';
                }
            });
        }

        // –°–æ–∑–¥–∞–Ω–∏–µ –ø–æ—Å—Ç–∞
        plusBtn.addEventListener('click', function() {
            postModal.classList.add('active');
            postText.value = '';
            imagePreview.style.display = 'none';
            currentImageData = '';
        });

        cancelPost.addEventListener('click', function() {
            postModal.classList.remove('active');
        });

        attachImageBtn.addEventListener('click', function() {
            imageInput.click();
        });

        imageInput.addEventListener('change', function(e) {
            let file = e.target.files[0];
            if (file) {
                let reader = new FileReader();
                reader.onload = function(event) {
                    imagePreview.src = event.target.result;
                    imagePreview.style.display = 'block';
                    currentImageData = event.target.result;
                };
                reader.readAsDataURL(file);
            }
        });

        submitPost.addEventListener('click', async function() {
            let text = postText.value.trim();
            if (text) {
                await createPost(text, currentImageData);
                postModal.classList.remove('active');
            }
        });

        // –ü–æ–∏—Å–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
        searchUsersBtn.addEventListener('click', function() {
            searchModal.classList.add('active');
            searchInput.value = '';
        });

        cancelSearch.addEventListener('click', function() {
            searchModal.classList.remove('active');
        });

        submitSearch.addEventListener('click', async function() {
            let query = searchInput.value.trim();
            if (query) {
                if (!query.startsWith('@')) query = '@' + query;
                
                const snapshot = await db.collection('users').where('username', '==', query).get();
                
                if (!snapshot.empty) {
                    const foundUser = snapshot.docs[0].data();
                    foundUser.uid = snapshot.docs[0].id;
                    showUserProfile(foundUser);
                    searchModal.classList.remove('active');
                    
                    for (let i = 0; i < screens.length; i++) {
                        screens[i].classList.remove('active');
                    }
                    document.getElementById('userProfileScreen').classList.add('active');
                } else {
                    alert('–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –Ω–∞–π–¥–µ–Ω');
                }
            }
        });

        // –°–æ–∑–¥–∞–Ω–∏–µ –≥—Ä—É–ø–ø—ã
        createGroupBtn.addEventListener('click', function() {
            let html = '';
            allUsers.forEach(u => {
                if (u.username !== user.username) {
                    html += `
                        <div class="member-item" data-username="${u.username}">
                            <div class="member-avatar">${u.avatar ? `<img src="${u.avatar}">` : '<i class="fas fa-user" style="color:#9d4eff; padding:12px;"></i>'}</div>
                            <div><div class="member-name">${u.name}</div><div class="member-username">${u.username}</div></div>
                            <div class="member-checkbox"></div>
                        </div>
                    `;
                }
            });
            groupMembersList.innerHTML = html;
            
            document.querySelectorAll('.member-item').forEach(item => {
                item.addEventListener('click', function() {
                    this.classList.toggle('selected');
                    let cb = this.querySelector('.member-checkbox');
                    cb.classList.toggle('selected');
                    cb.innerHTML = cb.classList.contains('selected') ? '‚úì' : '';
                });
            });
            
            createGroupModal.classList.add('active');
        });

        cancelGroup.addEventListener('click', function() {
            createGroupModal.classList.remove('active');
        });

        createGroup.addEventListener('click', function() {
            let name = groupName.value.trim();
            if (!name) {
                alert('–≤–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –≥—Ä—É–ø–ø—ã');
                return;
            }
            
            let selected = [];
            document.querySelectorAll('.member-item.selected').forEach(item => {
                selected.push(item.dataset.username);
            });
            
            if (selected.length < 2) {
                alert('–≤—ã–±–µ—Ä–∏—Ç–µ –º–∏–Ω–∏–º—É–º 2 —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤');
                return;
            }
            
            selected.push(user.username);
            
            let newGroup = {
                id: 'group_' + Date.now(),
                name: name,
                members: selected,
                messages: [],
                lastMessage: '–ì—Ä—É–ø–ø–∞ —Å–æ–∑–¥–∞–Ω–∞',
                lastMessageTime: '—Ç–æ–ª—å–∫–æ —á—Ç–æ'
            };
            
            groupChats.push(newGroup);
            renderChats();
            createGroupModal.classList.remove('active');
            groupName.value = '';
        });

        // –†–µ–Ω–¥–µ—Ä –ª–µ–Ω—Ç—ã
        function renderFeed() {
            if (posts.length === 0) {
                feedPosts.innerHTML = '<div class="empty-state"><i class="fas fa-pen"></i><p>–Ω–µ—Ç –ø–æ—Å—Ç–æ–≤</p><p>–Ω–∞–∂–º–∏ + —á—Ç–æ–±—ã —Å–æ–∑–¥–∞—Ç—å –ø–æ—Å—Ç</p></div>';
                return;
            }
            
            let html = '';
            for (let post of posts) {
                let postUser = allUsers.find(u => u.uid === post.userId) || { name: post.userName, avatar: post.userAvatar };
                
                html += `<div class="post${post.pinned ? ' pinned' : ''}" id="post-${post.id}">`;
                if (post.pinned) {
                    html += '<div class="post-pin-badge"><i class="fas fa-thumbtack"></i> –∑–∞–∫—Ä–µ–ø–ª–µ–Ω–æ</div>';
                }
                html += '<div class="post-header" onclick="showUserProfileFromPost(\'' + post.user + '\')">';
                html += '<div class="post-avatar">';
                if (postUser.avatar) html += '<img src="' + postUser.avatar + '">';
                else html += '<svg viewBox="0 0 64 64"><rect x="4" y="16" width="56" height="36" rx="4" fill="none" stroke="currentColor" stroke-width="2"/><circle cx="32" cy="34" r="10" fill="none" stroke="currentColor" stroke-width="2"/><rect x="14" y="10" width="8" height="6" rx="1" fill="none" stroke="currentColor" stroke-width="2"/></svg>';
                html += '</div>';
                html += '<div class="post-user-info">';
                html += '<div class="post-user-name">' + post.userName + ' ' + getVerifiedBadge(post.user) + '</div>';
                html += '<div class="post-user-username">' + post.user + '</div>';
                html += '<div class="post-time">' + post.time + '</div>';
                html += '</div>';
                
                if (post.userId === user.uid || isAdmin(user.username)) {
                    html += '<div class="post-menu">';
                    html += '<i class="fas fa-ellipsis-h post-menu-btn" onclick="toggleMenu(\'' + post.id + '\')"></i>';
                    html += '<div class="post-menu-dropdown" id="menu-' + post.id + '">';
                    if (post.userId === user.uid) {
                        html += '<div class="post-menu-item" onclick="pinPost(\'' + post.id + '\')"><i class="fas fa-thumbtack"></i> ' + (post.pinned ? '–æ—Ç–∫—Ä–µ–ø–∏—Ç—å' : '–∑–∞–∫—Ä–µ–ø–∏—Ç—å') + '</div>';
                    }
                    html += '<div class="post-menu-item delete" onclick="deletePost(\'' + post.id + '\', \'' + post.userId + '\')"><i class="fas fa-trash"></i> —É–¥–∞–ª–∏—Ç—å</div>';
                    html += '</div>';
                    html += '</div>';
                }
                html += '</div>';
                
                html += '<div class="post-content">' + post.content + '</div>';
                
                if (post.image) {
                    html += '<div class="post-image"><img src="' + post.image + '"></div>';
                }
                
                let isLiked = post.likedBy?.includes(user.uid);
                
                html += '<div class="post-actions">';
                html += '<div class="action like' + (isLiked ? ' liked' : '') + '" onclick="likePost(\'' + post.id + '\')"><i class="fas fa-heart"></i> ' + (post.likes || 0) + '</div>';
                html += '<div class="action" onclick="openComments(\'' + post.id + '\')"><i class="fas fa-comment"></i> ' + (post.comments?.length || 0) + '</div>';
                html += '</div>';
                html += '</div>';
            }
            feedPosts.innerHTML = html;
        }

        window.toggleMenu = function(postId) {
            document.querySelectorAll('.post-menu-dropdown.show').forEach(menu => {
                menu.classList.remove('show');
            });
            let menu = document.getElementById('menu-' + postId);
            if (menu) menu.classList.toggle('show');
        };

        window.deletePost = deletePost;
        window.pinPost = pinPost;
        window.likePost = likePost;

        window.showUserProfileFromPost = function(username) {
            let foundUser = allUsers.find(u => u.username === username);
            if (foundUser) {
                showUserProfile(foundUser);
                
                for (let i = 0; i < screens.length; i++) {
                    screens[i].classList.remove('active');
                }
                document.getElementById('userProfileScreen').classList.add('active');
            }
        };

        window.openComments = function(postId) {
            currentPostId = postId;
            let post = posts.find(p => p.id === postId);
            renderCommentsList(post?.comments || []);
            commentsModal.classList.add('active');
        };

        function renderCommentsList(comments) {
            let html = '';
            for (let i = 0; i < comments.length; i++) {
                let c = comments[i];
                let commentUser = allUsers.find(u => u.uid === c.userId) || { name: c.userName, avatar: c.userAvatar };
                
                html += '<div class="comment-item">';
                html += '<div class="comment-avatar" onclick="showUserProfileFromComment(\'' + c.user + '\')">';
                if (commentUser.avatar) html += '<img src="' + commentUser.avatar + '">';
                else html += '<svg viewBox="0 0 64 64"><rect x="4" y="16" width="56" height="36" rx="4" fill="none" stroke="currentColor" stroke-width="2"/><circle cx="32" cy="34" r="10" fill="none" stroke="currentColor" stroke-width="2"/><rect x="14" y="10" width="8" height="6" rx="1" fill="none" stroke="currentColor" stroke-width="2"/></svg>';
                html += '</div>';
                html += '<div class="comment-bubble' + (c.pinned ? ' pinned' : '') + '">';
                if (c.pinned) {
                    html += '<div class="comment-pin-badge"><i class="fas fa-thumbtack"></i> –∑–∞–∫—Ä–µ–ø–ª–µ–Ω–æ</div>';
                }
                html += '<div class="comment-header">';
                html += '<span class="comment-user" onclick="showUserProfileFromComment(\'' + c.user + '\')">' + c.user + ' ' + getVerifiedBadge(c.user) + '</span>';
                html += '<span class="comment-time">' + c.time + '</span>';
                html += '</div>';
                html += '<div class="comment-text">' + c.text + '</div>';
                
                if (c.image) {
                    html += '<img src="' + c.image + '" class="comment-image">';
                }
                
                let isLiked = c.likedBy?.includes(user.uid);
                
                html += '<div class="comment-actions">';
                html += '<div class="comment-action' + (isLiked ? ' liked' : '') + '" onclick="likeComment(\'' + currentPostId + '\',' + i + ')"><i class="fas fa-heart"></i> ' + (c.likes || 0) + '</div>';
                
                if (isAdmin(user.username) || c.userId === user.uid) {
                    html += '<div class="comment-action" onclick="deleteComment(\'' + currentPostId + '\',' + i + ')"><i class="fas fa-trash"></i></div>';
                }
                
                let post = posts.find(p => p.id === currentPostId);
                if (post && post.userId === user.uid) {
                    html += '<div class="comment-action" onclick="pinComment(\'' + currentPostId + '\',' + i + ')"><i class="fas fa-thumbtack"></i> ' + (c.pinned ? '–æ—Ç–∫—Ä–µ–ø–∏—Ç—å' : '–∑–∞–∫—Ä–µ–ø–∏—Ç—å') + '</div>';
                }
                html += '</div>';
                html += '</div>';
                html += '</div>';
            }
            if (comments.length === 0) html = '<div style="text-align:center; color:#666; padding:40px;">–Ω–µ—Ç –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤</div>';
            commentsList.innerHTML = html;
        }

        window.showUserProfileFromComment = function(username) {
            let foundUser = allUsers.find(u => u.username === username);
            if (foundUser) {
                showUserProfile(foundUser);
                commentsModal.classList.remove('active');
                
                for (let i = 0; i < screens.length; i++) {
                    screens[i].classList.remove('active');
                }
                document.getElementById('userProfileScreen').classList.add('active');
            }
        };

        window.likeComment = likeComment;
        window.deleteComment = deleteComment;
        window.pinComment = pinComment;

        // –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ - –ø—Ä–∏–∫—Ä–µ–ø–ª–µ–Ω–∏–µ —Ñ–æ—Ç–æ
        commentAttachBtn.addEventListener('click', function() {
            commentImageInput.click();
        });

        commentImageInput.addEventListener('change', function(e) {
            let file = e.target.files[0];
            if (file) {
                let reader = new FileReader();
                reader.onload = function(event) {
                    commentImagePreview.src = event.target.result;
                    commentPreviewContainer.style.display = 'inline-block';
                    currentCommentImage = event.target.result;
                };
                reader.readAsDataURL(file);
            }
        });

        removeCommentImage.addEventListener('click', function() {
            commentPreviewContainer.style.display = 'none';
            commentImagePreview.src = '';
            currentCommentImage = null;
        });

        sendComment.addEventListener('click', async function() {
            let text = commentInput.value.trim();
            if ((text || currentCommentImage) && currentPostId) {
                await addComment(currentPostId, text, currentCommentImage);
                commentInput.value = '';
                commentPreviewContainer.style.display = 'none';
                commentImagePreview.src = '';
                currentCommentImage = null;
            }
        });

        // –†–µ–Ω–¥–µ—Ä —á–∞—Ç–æ–≤
        function renderChats() {
            let personalHtml = '';
            for (let chat of personalChats) {
                let otherUser = chat.members.find(m => m !== user?.username);
                let userData = allUsers.find(u => u.username === otherUser);
                
                personalHtml += '<div class="chat-item" onclick="openChat(\'' + chat.id + '\', \'personal\')">';
                personalHtml += '<div class="chat-avatar">';
                if (userData && userData.avatar) personalHtml += '<img src="' + userData.avatar + '">';
                else personalHtml += '<i class="fas fa-user" style="color:#9d4eff; font-size:24px; padding:15px;"></i>';
                personalHtml += '</div>';
                personalHtml += '<div class="chat-info">';
                personalHtml += '<div class="chat-name">' + (userData ? userData.name : otherUser) + '</div>';
                personalHtml += '<div class="chat-last-message">' + (chat.lastMessage || '–Ω–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–π') + '</div>';
                personalHtml += '</div>';
                personalHtml += '<div class="chat-time">' + (chat.lastMessageTime || '') + '</div>';
                personalHtml += '</div>';
            }
            
            if (personalChats.length === 0) {
                personalHtml = '<div class="empty-state"><i class="fas fa-comments"></i><p>–Ω–µ—Ç –ª–∏—á–Ω—ã—Ö —á–∞—Ç–æ–≤</p><p style="font-size:14px;">–Ω–∞–π–¥–∏ –¥—Ä—É–∑–µ–π –≤ –ø–æ–∏—Å–∫–µ</p></div>';
            }
            
            personalChatsDiv.innerHTML = personalHtml;
            
            let groupHtml = '';
            for (let group of groupChats) {
                groupHtml += '<div class="chat-item" onclick="openChat(\'' + group.id + '\', \'group\')">';
                groupHtml += '<div class="chat-avatar">';
                groupHtml += '<i class="fas fa-users" style="color:#9d4eff; font-size:24px; padding:15px;"></i>';
                groupHtml += '</div>';
                groupHtml += '<div class="chat-info">';
                groupHtml += '<div class="chat-name">' + group.name + '</div>';
                groupHtml += '<div class="chat-last-message">' + (group.lastMessage || '–Ω–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–π') + '</div>';
                groupHtml += '</div>';
                groupHtml += '<div class="chat-time">' + (group.lastMessageTime || '') + '</div>';
                groupHtml += '</div>';
            }
            
            if (groupChats.length === 0) {
                groupHtml = '<div class="empty-state"><i class="fas fa-users"></i><p>–Ω–µ—Ç –≥—Ä—É–ø–ø</p><p style="font-size:14px;">–Ω–∞–∂–º–∏ + —á—Ç–æ–±—ã —Å–æ–∑–¥–∞—Ç—å</p></div>';
            }
            
            groupChatsDiv.innerHTML = groupHtml;
        }

        // –û—Ç–∫—Ä—ã—Ç—å —á–∞—Ç
        function openChat(chatId, type) {
            currentChat = { id: chatId, type: type };
            
            if (type === 'personal') {
                let chat = personalChats.find(c => c.id === chatId);
                if (chat) {
                    let otherUser = chat.members.find(m => m !== user.username);
                    let userData = allUsers.find(u => u.username === otherUser);
                    chatRoomName.textContent = userData ? userData.name : otherUser;
                    renderChatMessages(chat.messages || []);
                }
            }
            
            chatRoom.classList.add('active');
        }

        window.openChat = openChat;

        function renderChatMessages(messages) {
            let html = '';
            for (let msg of messages) {
                let isOwn = msg.sender === user.username;
                let senderUser = allUsers.find(u => u.username === msg.sender) || { name: msg.sender, avatar: '' };
                
                html += '<div class="chat-message' + (isOwn ? ' own' : '') + '">';
                if (!isOwn) {
                    html += '<div class="chat-message-avatar">';
                    if (senderUser.avatar) html += '<img src="' + senderUser.avatar + '">';
                    else html += '<i class="fas fa-user" style="color:#9d4eff; padding:8px;"></i>';
                    html += '</div>';
                }
                html += '<div class="chat-message-content">';
                if (!isOwn) {
                    html += '<div class="chat-message-sender">' + (senderUser.name || msg.sender) + '</div>';
                }
                
                if (msg.image) {
                    html += '<div class="chat-message-image"><img src="' + msg.image + '"></div>';
                }
                
                if (msg.text) html += '<div class="chat-message-text">' + msg.text + '</div>';
                html += '<div class="chat-message-time">' + msg.time + '</div>';
                html += '</div>';
                if (isOwn) {
                    html += '<div class="chat-message-avatar">';
                    if (user.avatar) html += '<img src="' + user.avatar + '">';
                    else html += '<i class="fas fa-user" style="color:#9d4eff; padding:8px;"></i>';
                    html += '</div>';
                }
                html += '</div>';
            }
            chatMessages.innerHTML = html || '<div style="text-align:center; color:#666; padding:40px;">–Ω–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–π</div>';
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }

        // –û—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏—è
        sendChatMessage.addEventListener('click', sendMessage);
        chatInput.addEventListener('keypress', (e) => e.key === 'Enter' && sendMessage());

        function sendMessage() {
            let text = chatInput.value.trim();
            if (!text || !currentChat) return;
            
            let now = new Date();
            let timeString = now.getHours() + ':' + (now.getMinutes() < 10 ? '0' + now.getMinutes() : now.getMinutes());
            
            let message = {
                id: Date.now(),
                sender: user.username,
                text: text,
                time: timeString
            };
            
            if (currentChat.type === 'personal') {
                let chat = personalChats.find(c => c.id === currentChat.id);
                if (chat) {
                    if (!chat.messages) chat.messages = [];
                    chat.messages.push(message);
                    chat.lastMessage = text;
                    chat.lastMessageTime = timeString;
                    renderChatMessages(chat.messages);
                }
            }
            
            chatInput.value = '';
        }

        // –ê–¥–º–∏–Ω —Ñ—É–Ω–∫—Ü–∏–∏
        function updateAdminStats() {
            document.getElementById('adminUserCount').textContent = allUsers.length;
            document.getElementById('adminPostCount').textContent = posts.length;
            
            let messageCount = 0;
            personalChats.forEach(chat => {
                messageCount += chat.messages?.length || 0;
            });
            groupChats.forEach(chat => {
                messageCount += chat.messages?.length || 0;
            });
            document.getElementById('adminMessageCount').textContent = messageCount;
            
            let giftCount = 0;
            allUsers.forEach(u => {
                giftCount += u.gifts?.length || 0;
            });
            document.getElementById('adminGiftCount').textContent = giftCount;
        }

        function renderAdminUserList() {
            let html = '';
            allUsers.forEach(u => {
                html += `
                    <div class="admin-user-item">
                        <div class="admin-user-avatar">
                            ${u.avatar ? `<img src="${u.avatar}">` : '<i class="fas fa-user" style="color:#9d4eff; padding:12px;"></i>'}
                        </div>
                        <div class="admin-user-info">
                            <div class="admin-user-name">${u.name}</div>
                            <div class="admin-user-username">${u.username}</div>
                        </div>
                        <div class="admin-user-actions">
                            <button class="admin-user-btn verify" onclick="verifyUser('${u.username}')">‚úÖ</button>
                            <button class="admin-user-btn ban" onclick="banUser('${u.username}')">üö´</button>
                        </div>
                    </div>
                `;
            });
            adminUserList.innerHTML = html || '<div class="empty-state">–Ω–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π</div>';
        }

        window.verifyUser = function(username) {
            if (isAdmin(user.username)) {
                alert(`–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å ${username} —Ç–µ–ø–µ—Ä—å –≤–µ—Ä–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω!`);
            }
        };

        window.banUser = function(username) {
            if (isAdmin(user.username)) {
                if (confirm(`–ó–∞–±–∞–Ω–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è ${username}?`)) {
                    alert(`–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å ${username} –∑–∞–±–∞–Ω–µ–Ω`);
                }
            }
        };

        // –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –∞–∫–∫–∞—É–Ω—Ç–∞
        document.getElementById('accountSettingsBtn').addEventListener('click', function() {
            for (let i = 0; i < screens.length; i++) {
                screens[i].classList.remove('active');
            }
            document.getElementById('accountSettingsScreen').classList.add('active');
            
            document.getElementById('phoneDisplay').textContent = user.phone || '+7 999 999-99-99';
            document.getElementById('usernameDisplay').textContent = user.username || '@username';
            document.getElementById('birthdayDisplay').textContent = user.birthday || '–Ω–µ —É–∫–∞–∑–∞–Ω';
            document.getElementById('firstNameDisplay').textContent = user.name || '–ò–º—è';
            document.getElementById('lastNameDisplay').textContent = user.lastName || '–Ω–µ —É–∫–∞–∑–∞–Ω–∞';
            document.getElementById('bioDisplay').textContent = user.bio || '‚Äî';
        });

        // –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ–ª–µ–π
        document.getElementById('changePhoneBtn').addEventListener('click', function() {
            currentEditField = 'phone';
            editModalTitle.textContent = '–∏–∑–º–µ–Ω–∏—Ç—å –Ω–æ–º–µ—Ä';
            editInput.value = user.phone;
            editModal.classList.add('active');
        });

        document.getElementById('changeUsernameBtn').addEventListener('click', function() {
            currentEditField = 'username';
            editModalTitle.textContent = '–∏–∑–º–µ–Ω–∏—Ç—å username';
            editInput.value = user.username;
            editModal.classList.add('active');
        });

        document.getElementById('changeBirthdayBtn').addEventListener('click', function() {
            currentEditField = 'birthday';
            editModalTitle.textContent = '–∏–∑–º–µ–Ω–∏—Ç—å –¥–µ–Ω—å —Ä–æ–∂–¥–µ–Ω–∏—è';
            editInput.value = user.birthday || '';
            editModal.classList.add('active');
        });

        document.getElementById('changeFirstNameBtn').addEventListener('click', function() {
            currentEditField = 'name';
            editModalTitle.textContent = '–∏–∑–º–µ–Ω–∏—Ç—å –∏–º—è';
            editInput.value = user.name;
            editModal.classList.add('active');
        });

        document.getElementById('changeLastNameBtn').addEventListener('click', function() {
            currentEditField = 'lastName';
            editModalTitle.textContent = '–∏–∑–º–µ–Ω–∏—Ç—å —Ñ–∞–º–∏–ª–∏—é';
            editInput.value = user.lastName || '';
            editModal.classList.add('active');
        });

        document.getElementById('changeBioBtn').addEventListener('click', function() {
            currentEditField = 'bio';
            editModalTitle.textContent = '–æ —Å–µ–±–µ';
            editInput.value = user.bio || '';
            editModal.classList.add('active');
        });

        cancelEdit.addEventListener('click', function() {
            editModal.classList.remove('active');
        });

        submitEdit.addEventListener('click', async function() {
            let value = editInput.value.trim();
            
            if (currentEditField === 'phone') {
                await db.collection('users').doc(user.uid).update({ phone: value });
                user.phone = value;
            } else if (currentEditField === 'username') {
                if (value.startsWith('@')) {
                    await db.collection('users').doc(user.uid).update({ username: value });
                    user.username = value;
                } else {
                    alert('username –¥–æ–ª–∂–µ–Ω –Ω–∞—á–∏–Ω–∞—Ç—å—Å—è —Å @');
                    return;
                }
            } else if (currentEditField === 'birthday') {
                await db.collection('users').doc(user.uid).update({ birthday: value });
                user.birthday = value;
            } else if (currentEditField === 'name') {
                await db.collection('users').doc(user.uid).update({ name: value });
                user.name = value;
            } else if (currentEditField === 'lastName') {
                await db.collection('users').doc(user.uid).update({ lastName: value });
                user.lastName = value;
            } else if (currentEditField === 'bio') {
                await db.collection('users').doc(user.uid).update({ bio: value });
                user.bio = value;
            }
            
            renderProfile();
            editModal.classList.remove('active');
        });

        // –ü–æ–∫–∞–∑–∞—Ç—å –ø—Ä–æ—Ñ–∏–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        window.showUserProfile = function(targetUser) {
            let userPosts = posts.filter(p => p.user === targetUser.username);
            
            let giftsHtml = '';
            if (targetUser.gifts && targetUser.gifts.length > 0) {
                giftsHtml = '<div class="profile-gifts">';
                targetUser.gifts.forEach(gift => {
                    giftsHtml += `
                        <div class="gift-badge">
                            <div class="gift-badge-icon">${gift.icon}</div>
                            <div class="gift-badge-text">${gift.text}</div>
                        </div>
                    `;
                });
                giftsHtml += '</div>';
            }
            
            let statusColor = targetUser.status === '–æ–Ω–ª–∞–π–Ω' ? '#2ecc71' : '#666';
            
            let html = `
                <div style="padding: 0 16px;">
                    <div style="display: flex; justify-content: space-between; align-items: center; padding: 15px 0; border-bottom: 1px solid #2a2a2a; margin-bottom: 20px;">
                        <i class="fas fa-arrow-left" style="color:#9d4eff; font-size:20px; cursor:pointer;" onclick="document.getElementById('backFromUserProfile').click()"></i>
                        <h2 style="font-size:20px; font-weight:600;">${targetUser.name}</h2>
                        <i class="fas fa-ellipsis-v" style="color:#9d4eff;"></i>
                    </div>
                    
                    <!-- –ë–ê–ù–ù–ï–† (–†–ê–ë–û–¢–ê–ï–¢!) -->
                    <div style="height: 150px; background: linear-gradient(145deg, #2a1a3a, #1a0a2a); border-radius: 20px; margin-bottom: 60px; position: relative; cursor:pointer;" onclick="document.getElementById('bannerModal').classList.add('active')">
                        ${targetUser.banner ? `<img src="${targetUser.banner}" style="width:100%; height:100%; object-fit:cover; border-radius:20px;">` : ''}
                        <div style="position:absolute; bottom:10px; right:10px; background:rgba(0,0,0,0.5); width:40px; height:40px; border-radius:50%; display:flex; align-items:center; justify-content:center;">
                            <i class="fas fa-camera"></i>
                        </div>
                    </div>
                    
                    <div style="display: flex; justify-content: center; margin-bottom: 15px;">
                        <div style="width: 100px; height: 100px; border-radius: 50%; border: 3px solid #9d4eff; overflow: hidden;">
                            ${targetUser.avatar ? `<img src="${targetUser.avatar}" style="width:100%; height:100%; object-fit:cover;">` : '<div style="width:100%; height:100%; background:#2a2a2a; display:flex; align-items:center; justify-content:center;"><i class="fas fa-user" style="font-size:40px; color:#9d4eff;"></i></div>'}
                        </div>
                    </div>
                    
                    <div style="text-align: center; margin-bottom: 15px;">
                        <span style="display: inline-block; width: 10px; height: 10px; border-radius: 50%; background: ${statusColor}; box-shadow: 0 0 10px ${statusColor}; margin-right: 5px;"></span>
                        <span style="color: #888;">${targetUser.status}</span>
                    </div>
                    
                    <div style="text-align: center; margin-bottom: 20px;">
                        <div style="font-size: 24px; font-weight: 700; display: flex; align-items: center; justify-content: center; gap: 8px;">
                            ${targetUser.name}
                            ${isAdmin(targetUser.username) ? '<i class="fas fa-check-circle" style="color:#9d4eff;"></i>' : ''}
                        </div>
                        <div style="color: #9d4eff; font-size: 15px; margin-top: 5px;">${targetUser.username}</div>
                    </div>
                    
                    ${giftsHtml}
                    
                    <div style="background: #1a1a1a; border-radius: 16px; padding: 15px; margin-bottom: 20px;">
                        <div style="display: flex; align-items: center; gap: 15px; padding: 8px 0;">
                            <i class="fas fa-phone" style="color: #9d4eff; width: 20px;"></i>
                            <div style="color: #666; font-size: 13px;">–º–æ–±–∏–ª—å–Ω—ã–π</div>
                            <div style="color: #fff; margin-left: auto;">${targetUser.phone}</div>
                        </div>
                        <div style="display: flex; align-items: center; gap: 15px; padding: 8px 0;">
                            <i class="fas fa-at" style="color: #9d4eff; width: 20px;"></i>
                            <div style="color: #666; font-size: 13px;">–∏–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</div>
                            <div style="color: #fff; margin-left: auto;">${targetUser.username}</div>
                        </div>
                        ${targetUser.birthday ? `
                        <div style="display: flex; align-items: center; gap: 15px; padding: 8px 0;">
                            <i class="fas fa-birthday-cake" style="color: #ff6b9d; width: 20px;"></i>
                            <div style="color: #666; font-size: 13px;">–¥–µ–Ω—å —Ä–æ–∂–¥–µ–Ω–∏—è</div>
                            <div style="color: #fff; margin-left: auto;">${targetUser.birthday}</div>
                        </div>
                        ` : ''}
                    </div>
                    
                    <div style="display: flex; justify-content: space-around; background: #1a1a1a; border-radius: 30px; padding: 20px; margin-bottom: 20px;">
                        <div style="text-align: center;">
                            <div style="font-size: 22px; font-weight: 700; color: #9d4eff;">${userPosts.length}</div>
                            <div style="font-size: 12px; color: #666;">–ø—É–±–ª–∏–∫–∞—Ü–∏–∏</div>
                        </div>
                        <div style="text-align: center;">
                            <div style="font-size: 22px; font-weight: 700; color: #9d4eff;">${targetUser.gifts?.length || 0}</div>
                            <div style="font-size: 12px; color: #666;">–ø–æ–¥–∞—Ä–∫–∏</div>
                        </div>
                    </div>
                    
                    ${targetUser.username !== user?.username ? `
                        <button style="background:#9d4eff; color:#fff; border:none; border-radius:30px; padding:16px; width:100%; font-weight:600; margin-bottom:20px; cursor:pointer;" onclick="startPersonalChat('${targetUser.username}')">
                            <i class="fas fa-comment"></i> –Ω–∞–ø–∏—Å–∞—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ
                        </button>
                    ` : ''}
                    
                    <div style="display: flex; gap: 10px; margin-bottom: 20px; border-bottom: 1px solid #2a2a2a;">
                        <div style="flex:1; text-align:center; padding:12px; color:#9d4eff; border-bottom:2px solid #9d4eff; font-weight:600;">–ü—É–±–ª–∏–∫–∞—Ü–∏–∏</div>
                    </div>
                    
                    <div>
                        ${userPosts.length > 0 ? userPosts.map(post => `
                            <div class="post" style="margin:10px 0;">
                                <div class="post-content" style="margin-left:0;">${post.content}</div>
                                ${post.image ? `<div class="post-image" style="margin-left:0;"><img src="${post.image}"></div>` : ''}
                            </div>
                        `).join('') : '<div class="empty-state">–Ω–µ—Ç –ø—É–±–ª–∏–∫–∞—Ü–∏–π</div>'}
                    </div>
                </div>
            `;
            
            userProfileContent.innerHTML = html;
        };

        // –ù–∞—á–∞—Ç—å –ª–∏—á–Ω—ã–π —á–∞—Ç
        window.startPersonalChat = function(username) {
            let existingChat = personalChats.find(c => 
                c.members && c.members.includes(user.username) && c.members.includes(username)
            );
            
            if (!existingChat) {
                let newChat = {
                    id: 'chat_' + Date.now(),
                    members: [user.username, username],
                    messages: [],
                    lastMessage: '',
                    lastMessageTime: ''
                };
                personalChats.push(newChat);
                existingChat = newChat;
            }
            
            for (let i = 0; i < screens.length; i++) {
                screens[i].classList.remove('active');
            }
            document.getElementById('chatsScreen').classList.add('active');
            
            for (let j = 0; j < chatTabs.length; j++) {
                chatTabs[j].classList.remove('active');
            }
            chatTabs[0].classList.add('active');
            personalChatsDiv.style.display = 'block';
            groupChatsDiv.style.display = 'none';
            
            renderChats();
            openChat(existingChat.id, 'personal');
        };

        // –†–µ–Ω–¥–µ—Ä –ø—Ä–æ—Ñ–∏–ª—è
        function renderProfile() {
            if (!user) return;
            
            let userPosts = user.posts || [];
            let pinnedPost = userPosts.find(p => p.pinned);
            let otherPosts = userPosts.filter(p => !p.pinned);
            
            let giftsHtml = '';
            if (user.gifts && user.gifts.length > 0) {
                giftsHtml = '<div class="profile-gifts">';
                user.gifts.forEach(gift => {
                    giftsHtml += `
                        <div class="gift-badge">
                            <div class="gift-badge-icon">${gift.icon}</div>
                            <div class="gift-badge-text">${gift.text}</div>
                        </div>
                    `;
                });
                giftsHtml += '</div>';
            }
            
            let statusColor = user.status === '–æ–Ω–ª–∞–π–Ω' ? '#2ecc71' : '#666';
            
            let html = `
                <div style="padding: 0 16px;">
                    <div style="display: flex; justify-content: space-between; align-items: center; padding: 15px 0; border-bottom: 1px solid #2a2a2a; margin-bottom: 20px;">
                        <i class="fas fa-chevron-left" style="color: #9d4eff;"></i>
                        <h2 style="font-size: 20px; font-weight: 600;">${user.name}</h2>
                        <div style="display: flex; gap: 15px;">
                            <i class="fas fa-bell" style="color: #9d4eff;"></i>
                            <i class="fas fa-ellipsis-v" style="color: #9d4eff;"></i>
                        </div>
                    </div>
                    
                    <!-- –ë–ê–ù–ù–ï–† (–†–ê–ë–û–¢–ê–ï–¢!) -->
                    <div style="height: 150px; background: linear-gradient(145deg, #2a1a3a, #1a0a2a); border-radius: 20px; margin-bottom: 60px; position: relative; cursor:pointer;" onclick="document.getElementById('bannerModal').classList.add('active')">
                        ${user.banner ? `<img src="${user.banner}" style="width:100%; height:100%; object-fit:cover; border-radius:20px;">` : ''}
                        <div style="position:absolute; bottom:10px; right:10px; background:rgba(0,0,0,0.5); width:40px; height:40px; border-radius:50%; display:flex; align-items:center; justify-content:center;">
                            <i class="fas fa-camera"></i>
                        </div>
                    </div>
                    
                    <div style="display: flex; justify-content: center; margin-bottom: 15px;">
                        <div style="width: 100px; height: 100px; border-radius: 50%; border: 3px solid #9d4eff; overflow: hidden; cursor:pointer;" onclick="document.getElementById('fileInput').click()">
                            ${user.avatar ? `<img src="${user.avatar}" style="width:100%; height:100%; object-fit:cover;">` : '<div style="width:100%; height:100%; background:#2a2a2a; display:flex; align-items:center; justify-content:center;"><i class="fas fa-user" style="font-size:40px; color:#9d4eff;"></i></div>'}
                        </div>
                    </div>
                    
                    <div style="text-align: center; margin-bottom: 15px;">
                        <span style="display: inline-block; width: 10px; height: 10px; border-radius: 50%; background: ${statusColor}; box-shadow: 0 0 10px ${statusColor}; margin-right: 5px;"></span>
                        <span style="color: #888;">${user.status}</span>
                    </div>
                    
                    <div style="text-align: center; margin-bottom: 20px;">
                        <div style="font-size: 24px; font-weight: 700; display: flex; align-items: center; justify-content: center; gap: 8px;">
                            ${user.name}
                            ${isAdmin(user.username) ? '<i class="fas fa-check-circle" style="color:#9d4eff;"></i>' : ''}
                        </div>
                        <div style="color: #9d4eff; font-size: 15px; margin-top: 5px;">${user.username}</div>
                    </div>
                    
                    ${giftsHtml}
                    
                    <div style="background: #1a1a1a; border-radius: 16px; padding: 15px; margin-bottom: 20px;">
                        <div style="display: flex; align-items: center; gap: 15px; padding: 8px 0;">
                            <i class="fas fa-phone" style="color: #9d4eff; width: 20px;"></i>
                            <div style="color: #666; font-size: 13px;">–º–æ–±–∏–ª—å–Ω—ã–π</div>
                            <div style="color: #fff; margin-left: auto;">${user.phone}</div>
                        </div>
                        <div style="display: flex; align-items: center; gap: 15px; padding: 8px 0;">
                            <i class="fas fa-at" style="color: #9d4eff; width: 20px;"></i>
                            <div style="color: #666; font-size: 13px;">–∏–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</div>
                            <div style="color: #fff; margin-left: auto;">${user.username}</div>
                        </div>
                        ${user.birthday ? `
                        <div style="display: flex; align-items: center; gap: 15px; padding: 8px 0;">
                            <i class="fas fa-birthday-cake" style="color: #ff6b9d; width: 20px;"></i>
                            <div style="color: #666; font-size: 13px;">–¥–µ–Ω—å —Ä–æ–∂–¥–µ–Ω–∏—è</div>
                            <div style="color: #fff; margin-left: auto;">${user.birthday}</div>
                        </div>
                        ` : ''}
                    </div>
                    
                    <div style="display: flex; justify-content: space-around; background: #1a1a1a; border-radius: 30px; padding: 20px; margin-bottom: 20px;">
                        <div style="text-align: center;">
                            <div style="font-size: 22px; font-weight: 700; color: #9d4eff;">${userPosts.length}</div>
                            <div style="font-size: 12px; color: #666;">–ø—É–±–ª–∏–∫–∞—Ü–∏–∏</div>
                        </div>
                        <div style="text-align: center;">
                            <div style="font-size: 22px; font-weight: 700; color: #9d4eff;">${user.gifts?.length || 0}</div>
                            <div style="font-size: 12px; color: #666;">–ø–æ–¥–∞—Ä–∫–∏</div>
                        </div>
                    </div>
                    
                    <div style="display: flex; gap: 10px; margin-bottom: 20px; border-bottom: 1px solid #2a2a2a;">
                        <div style="flex:1; text-align:center; padding:12px; color:#9d4eff; border-bottom:2px solid #9d4eff; font-weight:600;">–ü—É–±–ª–∏–∫–∞—Ü–∏–∏</div>
                    </div>
                    
                    <div>
                        ${pinnedPost ? `
                            <div class="post pinned" style="margin:10px 0;">
                                <div class="post-content" style="margin-left:0;">${pinnedPost.content}</div>
                                ${pinnedPost.image ? `<div class="post-image" style="margin-left:0;"><img src="${pinnedPost.image}"></div>` : ''}
                            </div>
                        ` : ''}
                        ${otherPosts.map(post => `
                            <div class="post" style="margin:10px 0;">
                                <div class="post-content" style="margin-left:0;">${post.content}</div>
                                ${post.image ? `<div class="post-image" style="margin-left:0;"><img src="${post.image}"></div>` : ''}
                            </div>
                        `).join('')}
                        ${userPosts.length === 0 ? '<div class="empty-state">–Ω–µ—Ç –ø—É–±–ª–∏–∫–∞—Ü–∏–π</div>' : ''}
                    </div>
                </div>
            `;
            
            profileContent.innerHTML = html;
        }

        // –ó–∞–≥—Ä—É–∑–∫–∞
        window.onload = function() {
            // –ü—É—Å—Ç–æ, –∂–¥–µ–º –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é
        };
    </script>
</body>
</html>